<?php
/**
 * BlockQuote Class
 * Author: Willem Prins | SOMTIJDS
 * Project: Tandem
 * Date created: 07/03/2016
 *
 * @package Exchange Plugin
 **/

// Exit if accessed directly.
if ( ! defined( 'ABSPATH' ) ) {
	header( 'Status: 403 Forbidden' );
	header( 'HTTP/1.1 403 Forbidden' );
	exit;
};

/**
 * Blockquote pattern class.
 *
 * This class serves to build paragraph elements.
 *
 * @since 0.1.0
 **/
class BlockQuote extends BaseQuote {

	/**
	 * Overwrite initial output value for Blockquotes
	 *
	 * @since 0.1.0
	 * @access protected
	 **/
	 protected function create_output() {
		if ( empty( $this->input['bquote_text'] ) ) {
			return;
		}
		$border_svg = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10.5 287.56124" width="100%" height="100%" preserveAspectRatio="none"><path fill="' . exchange_slug_to_hex( 'primary-colour' ) . '" fill-rule="evenodd" d="M0 3.75v-.375c.625 0 .375-.75.625-1.25 0-.5-.375-.875 0-1.25C1 .875 1 .25 1.5.375c.5 0 .75-.5 1.25-.375H3c.375.25.625 0 .625.375 0 0 0 .375.625.25h.25c.25 0 .25.375.5.25 0 .375.5.375.5.625V2s.25.25 0 .25c0 .5.25.625.375.875-.375 0 0 .75-.375.625V4s0 .375-.25.375c0 .625.375.5.5.875-.375 0-.5.5-.5.875.375 0 0 .5 0 .625.375 0 .5.25.5.625v.875c-.25 0-.25.25-.25.5 0 .375.25.375.375.5-.25 0-.375.375-.375.625s-.25.25-.25.625v.75c.5 0 .5.25.25.5 0 .5-.375.625-.25 1.25 0 .375.5.25.25.75-.375 0 .25.375 0 .625-.25 0 0 .5-.375.5 0 .375.625.25.5.75 0 0 0 .375-.25.5V17.5h.25s.25 0 .25.375c0 0-.25 0-.25.25v1.25s.375.25.5.625v.25l-.25.25v.75c0 .5.375.5.375.75-.25 0-.25.375-.375.375V23c0 .625.625.5.625 1-.25 0-.25.375-.25.625-.375 0 0 .75-.25.625 0 .5.625.375.5 1 0 .625 0 .875-.25 1.25 0 .5.875.5.5 1 0 .625-.375.625-.5 1.25.25 0 .25.25.375.25 0 .25.25.25 0 .625.25.625-.375.375 0 1v.5h.25s.25.25 0 .375v.5c0 .25 0 .5-.25.625V35l-.5.625s0 .25.25.25c0 0 0 .375-.25.375v.375c0 .25 0 .5-.25.5 0 .25 0 .5.25.625 0 .25.5.25.375.75 0 .5 0 .875-.5 1 0 .625.5.375.375 1-.25 0 0 .375 0 .625-.375.25-.5.5-.5.75 0 .375.5.375.375 1 0 .5-.25.5 0 1V46.5l.25.375c-.25 0 0 .375 0 .5 0 .25-.375.375-.25.625 0 .5.375.375.375.75 0 0 0 .375-.25.5 0 0-.25 0 0 .375 0 0 0 .25 0 0 .25.375 0 .5 0 .625 0 .25.375.25.25.75l-.25 1.5s.375.625 0 .625V54.5s-.25 0 0 .25h.25c.25.25 0 .5 0 .625V59s.25 0 .25.375c0 0 0 .25-.25.25v.25s0 .625-.25.625c0 .25 0 .375.25.5v.75c0 .625 0 1.25.25 1.625 0 0-.25 0-.375.375 0 .25 0 .5-.25.5 0 .75.625.5.375 1.25v.375c-.375 0 0 .5-.375.5V67s.25 0 .25.25v.375c-.25 0-.25 0-.25.25v1.25s0 .375.25.375v.875l-.25.875c.25.5.25 1.625 0 2.125 0 .375.625.25.5.875-.25.25 0 .875-.25 1.25 0 .375.5.25.375.875v1.25c-.25 0-.25 0 0 .25v.375c-.375-.25 0 .5-.25.5v.75c-.25.5.375.375.25.875 0 0 0 .375-.25.5 0 0 .25.25 0 .625-.5 0 0 .625.25.875h-.25v.5c0 .375-.375.5-.375.875 0 .25 0 .375.25.375 0 .25 0 .5-.25.5v1c0 .5 0 .625.25 1-.375 0-.5.375-.5.75.25.375 0 .5 0 1.25 0 0 0 .375-.25.375 0 .25 0 .75-.25.75 0 .25.375.375.375.5V91s-.25 0 0 .25c-.25 0-.375 0-.375.25v.5c.25.375 0 .875-.25 1.25v.25c.375 0 .25.25.25.5 0 .375.25.375.375.75-.25 0-.25.25-.375.375v.75c0 .375.375.25.25.75-.25.375-.5.625-.375 1.25v.625c.625.25 0 .375 0 .75 0 .625.25 1.25.375 1.625 0 .5-.375.625-.25 1.25 0 .5.5.375.375 1 0 .625-.25.625 0 1.25a.75.75 0 0 0 .25.375v1.75c0 .375.5.375.5.625-.25 0 0 .25-.25.375l-.125 1.25h.25v.5h.25v2c0 .5.25.5 0 1 0 .625.25.75 0 1.25a.75.75 0 0 0 0 .375c.375 0 .25.375.25.625l-.25 1.25c0 .25.5 0 .25.75v.25c-.375 0-.25.375-.25.625a.75.75 0 0 0 0 .5c.375 0 .25.5.25.75v.75l.25.875c0 .25-.25.25-.25.625-.375 0 0 .75-.25.625 0 .625.625.5.5 1.25-.375 0-.375.25-.25.5l.25.75c.375 0 0 .5 0 .625v.75c-.25.5.375.875.25 1.5l-.25 1.25c0 .375.375.25.25.625v.75c.25.5 0 .375 0 .75v.25c.25 0 .375 0 .25.25 0 .25 0 .5-.25.5v.75c-.25.5.5.375.25 1 0 .25-.375.25-.25.625 0 .25-.375 0-.25.625 0 0 0 .25.25.25 0 .25.25.25 0 .5v3.375c.25.25 0 .375 0 .5H8v.5c0 .625-.25.875-.375 1.25.375.5.25 1.25.25 1.625 0 .75.5.5.5 1.25l-.25 1.25c0 .25.25.375.375.625 0 0-.375 0-.25.375V147l.25.5c0 .375-.5.625-.375 1.25l.25.875v1.25c0 .625.625.375.5 1.25 0 .375-.25.5-.375.75 0 .5.375.5.375 1.25-.375 0 0 .5-.25.75v.875c0 .375-.375.375-.375.75 0 .25-.25.375-.5.5 0 .25.25.375.5.5l-.25.75v.375l-.25.625v.5c.25 0 .375.25 0 .375l-.25 1.25V164c0 .5 0 .875-.25 1.25 0 .25 0 .5.25.5v.25c.25.5 0 .5 0 .875v1.5l-.25.75c.5.25 0 .625 0 .875l.25.875-.25 1.25c0 .25 0 .375.375.5-.25.25 0 .5 0 .75s-.375 0-.25.5c0 .375.5.5.375 1.25V176c0 .625.375.5.25.875-.375 0 0 .75-.25.625v.375c-.25.5 0 .5 0 .875V180c0 .5.5.375.5.875-.5 0 0 .5 0 .75 0 0-.25 0-.25.375l.375.25c0 .75.375 1.25 0 2 0 0 .25 0 .25.25.25 0 .375 0 .375.25 0 .375 0 .5-.25.625V186c-.25.625.375.5.375 1-.25 0-.25.5-.375.75 0 0 .25 0 0 .375v.25l.375.375v.25c0 .625-.375.75-.25 1.25 0 .5.375.375.375.75l.25.875v2.375c0 .5.25.375 0 .75 0 .375 0 .75.25.875V198c0 .75.375.75.375 1.25s-.375.375-.375.875c.375 0 0 .625.25.875v.875c.25.5 0 .5 0 .875l.25.625v.25c0 .375-.25.5 0 1v1.625c0 .375-.25.5 0 1v.25c.25.25.375.375.25.625 0 .875 0 1.25.25 2.125 0 .25 0 .75-.25.875 0 .375.375.5.375 1-.25.375-.25 1.25-.5 1.625v.375a.75.75 0 0 0 .25.625l-.25 1c0 .5.25.875.375 1.25 0 .25-.375.375-.375.875.25.25 0 .75.25 1.25v3.125s.25 0 .25.5c-.375.5-.25 1.25 0 1.875V225c-.375 0-.25.25-.25.375l-.25 1.25h.25c-.25 0-.25.375-.25.625 0 .375-.25.375 0 .875v1.125l.375 1.875s0 .5-.375.75l-.25.875v3.5s.25.375 0 .5c0 .25-.25.375 0 .375 0 .375.25.375 0 .75v1.25c-.25.375 0 .5 0 1l-.25 1.25.25.25v1.75c0 .375.25.625 0 1.25v.625s-.25.625 0 .625v.875c-.25 0 .25.75 0 .625V248H10v.875s0 .375-.25.375v1c-.25 0 .25.75 0 .75 0 .25-.25.25-.25.375 0 0 0 .375-.25.5 0 .375.375.25.375.5v.875c0 .25-.25.5 0 .75 0 .375.25.25 0 .75v2.875c0 .25-.25.25 0 .5v.5c0 .375-.5.5-.375 1v1.75l-.375 1.5v2.875s0 .75-.25.75v2.375c0 .375.5.375.375.875v1c0 .625.5.5.375 1-.375 0 0 .625-.25.5.25.5 0 .375 0 .75.25 0 .25.75 0 .625v1.5c0 .25.5.25.375.625v1.5c0 .5 0 1.25.375 1.625l-.25.5c0 .25.25.25.25.625 0 0-.375.375-.375.875s.25.75.375 1c0 .375-.5.375-.5.625v.5s0 .375-.25.375v1.375c0 .625-.25 1-.375 1.5 0 0 0 .25-.25.375 0 0-.375 0-.5.25-.25 0 0 .625-.625.75 0 .375-.25.875-.75.875s-.625.375-1.25.5h-.75c0-.25-.25-.375-.5-.375 0-.25-.375-.25-.25-.625 0-.375-.25-.375-.25-.875l-.25-.625c0-.25-.375-.375-.25-.75v-.875c.5 0 .25-.625.5-.75v-1.25c.25 0 .25-.5.375-.625-.25-.25 0-.5 0-.5 0-.25 0-.5.5-.5v-.75c.25-.25.25-.375 0-.625 0-.25 0-.75.25-.75 0-.375.5-.625 0-.75 0-.375.25-.375 0-.75v-3c0-.25.25-.25 0-.5v-.5c-.25 0 0-.375 0-.625-.375 0-.25-.25-.25-.5h-.25v-.375c0-.25 0-.25.25-.375V271l-.25-1.25c.375-.75.375-2 .5-2.875v-2l.25-.625s0-.375-.25-.375V262c.375-.375.375-.625.25-1 .25 0 .25-.25.25-.5v-5c.25 0 0-.5 0-.625v-1.75c0-.25.375-.25 0-.375 0-.375.375-.375.25-.875v-1.75c0-.5 0-1 .25-1.25v-3.125c-.25-.25-.375-.5-.375-.875.25-.25.5-.5.375-1.25V243c-.25 0 0-.5 0-.5V240c.25-.375 0-.5 0-.75-.25 0-.25-.75 0-.625V237c0-.25-.25-.375 0-.375 0-.25.25-.5 0-.75 0-.625 0-1.25.375-1.625l-.25-.75v-1.25s-.25 0 0 0v-1.75c-.375-.25.25-.5.25-.625v-2" /></svg>';
		$png_src = get_stylesheet_directory() . '/assets/images/png/exchange_line_Vert_WEB.png';
		if ( file_exists( realpath( $png_src ) ) ) {
			$border_svg = exchange_insert_svg_fallback( $border_svg, $png_src );
		}
		// Open element.
		$this->output_tag_open();
		$this->output .= '<div class="blockquote__border-image blockquote__border-image--left">' . $border_svg . '</div>';
		$this->output .= '<blockquote>';
		$this->output .= $this->input['bquote_text'];
		$this->output .= '</blockquote>';
		$this->output .= '<div class="blockquote__border-image blockquote__border-image--right">' . $border_svg . '</div>';

		// Prepare caption.
		$this->set_quote_caption();
		if ( $this->has_caption ) {
			$this->output .= $this->caption->embed();
		}

		// Close element.
		$this->output_tag_close();
	}
}
